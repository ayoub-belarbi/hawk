<%= content_for :javascripts do %>
  <%= javascript_include_tag "dashboard" %>
<% end %>
<div class="container-fluid" id="dashboard-container">
  <div class="row">
    <h1>
      <%= icon_text "dashboard", _("Dashboard"), class: "page" %>
      <div class="pull-right">
        <div class="btn-group" role="group">
          <%= link_to icon_text("plus", _("Add Cluster")), add_dashboard_path, class: "btn btn-default", data: {toggle: "modal", target: "#modal" } %>
        </div>
      </div>
    </h1>
  </div>
  <div class="row" id="clusters"></div>
  <% # passing null as name and host means to fetch local cluster information %>
  <% unless current_cib.offline? %>
    <script>
      dashboardAddCluster({"name":null, "host":null, "port":null, https:null, "interval":10});
    </script>
  <% end %>
  <script>
    <%=raw javascript_for_clusters @clusters %>
  </script>

  <div id="cib-status-matrix-details"></div>

  <div id="status-table"></div>

  <script id="status-table-template" type="text/x-jsrender">
    <table class="table table-bordered">
      <tbody>
        {{!-- NODES ROW --}}
        <tr>
            <th class="col-sm-1"></th>
            {{for ~root.nodes itemVar="~node"}}
                <th>{{:name}}<span>{{:~root.cluster_name}}</span>
                    {{if ~node.state === "unclean"}}
                        <div><small><i><em>"This node is in an unclean state"</em></i></small></div>
                    {{else ~node.state === "online"}}
                        <div><small><i><em>"This node is online"</em></i></small></div>
                    {{else ~node.state === "offline"}}
                        <div><small><i><em>"This node is offline"</em></i></small></div>
                    {{/if}}
                    {{if ~node.remote == true}}
                        <div><small><i><em>"This node is Remote"</em></i></small></div>
                    {{/if}}
                    {{if ~node.maintenance == true}}
                        <div><small><i><em>"This node is in maintenance mode"</em></i></small></div>
                    {{/if}}
                </th>
            {{/for}}
        </tr>
        {{!-- END NODES  --}}
        {{!-- RESOURCES ROWS --}}
        {{for ~root.resources itemVar="~resource"}}
            <tr>
                <td class="text-left">{{:name}}
                    {{if ~resource._stopped == true}}
                        <div><small>"This resource is stopped"</small></div>
                    {{/if}}
                </td>
                {{for ~root.nodes itemVar="~node"}}
                    <td>
                    {{if ~node.state === "unclean" }}
                        <i class="fa fa-circle fa-lg text-danger" title="Started"></i>
                        <div><small><i><em>"The node is in an unclean state"</em></i></small></div>
                    {{/if}}
                    {{if ~resource.instances.length == 0}}
                          <div><small><i><em>
                              'This resource is not runnin on any node'
                          </em></i></small></div>
                    {{else}}
                          {{for ~resource.instances itemVar="~instance"}}
                            {{if ~node.state === "offline" }}
                              "The node is offline"
                            {{else ~node.state === "unclean" }}
                                "The node is unclean"
                            {{else (~instance.node === ~node.name) && (~instance.state === "started")}}
                              <i class="fa fa-circle fa-lg text-success" title="Started"></i>
                              <br>"The node is started in this node"
                            {{/if}}
                          {{/for}}
                    {{/if}}
                    </td>
                {{/for}}
            </tr>
        {{/for}}
        {{!-- END RESOURCES --}}
      </tbody>
      </table>
  </script>
</div>
